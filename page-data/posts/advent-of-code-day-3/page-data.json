{"componentChunkName":"component---src-templates-post-template-jsx","path":"/posts/advent-of-code-day-3/","webpackCompilationHash":"a601475e34d0d49b44c0","result":{"data":{"site":{"siteMetadata":{"title":"Harry's Tech Blog","subtitle":"Personal development. Tech. Bugs.","copyright":"(copyleft) no rights reserved.","author":{"name":"Harry Fitzgerald"},"url":"https://www.hjf.io"}},"markdownRemark":{"id":"6a940570-4f3b-553c-a399-4cf2561c65ab","html":"<p>I’m busy, but in my spare time when I’m not engineering at work, I’m engineering at home. Recently, I’ve hit a dry streak with stuff to do. I’ve already written <a href=\"https://github.com/hjfitz/relay.ts\">1</a>, <a href=\"https://github.com/hjfitz/yanc-webserver\">2</a> clones of Express and I can’t take it anymore. That’s why I’m thankful for <a href=\"https://adventofcode.com/\">Avent of Code</a>.</p>\n<p>Whenever there’s been some downtime, I’ve tackled it. <a href=\"https://adventofcode.com/2019/day/3\">Day 3</a> was difficult and actually a nice challenge, so I thought I’d take you, the reader, along for the ride. It took a few attempts to actually solve. I went in without proper planning and at it’s height, my solution consumed <strong>112GB</strong> of memory.</p>\n<p>This is a journey of learning how to better utilise memory in a Node.js program. I could have opted for something like Go, but honestly I’ve never attempted something like Day 3 and overall feel more comfortable in Node. There’s also some nice features that I use here.</p>\n<h1>The Problem</h1>\n<p>I’ll cut it short as the website has a bunch of (fun) fluff around the problem. In effect, you’re given two sets of wire ‘paths’ and must find where they intersect. You then answer with the shortest <a href=\"https://en.wikipedia.org/wiki/Taxicab_geometry\">Manhattan Distance</a> from the origin to intersection.</p>\n<p>Your input dataset consists of two wire-paths. The input may look like:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">R8,U5,L5,D3\nU7,R6,D4,L4</code></pre></div>\n<p>As an example, the top line states that the wire goes Right by 8 units, Up by 5, Left by 5 and Down by 3. Drawn out, this looks like:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">...........\n.+-----+...\n.|.....|...\n.|..+--X-+.\n.|..|..|.|.\n.|.-X--+.|.\n.|..|....|.\n.|.......|.\n.o-------+.\n...........</code></pre></div>\n<p>Seems simple, right? Turns out, it’s a challenge - and a fun one at that. Let’s get started!</p>\n<h1>A Few Solutions…</h1>\n<p>Every one of my days have worked in the same way:</p>\n<ol>\n<li>Read the data in</li>\n<li>Parse it</li>\n<li><del>draw the rest of the fucking owl</del> Solve it</li>\n</ol>\n<h2>Read the Data</h2>\n<p>This never changed. Store the data in a file and <code class=\"language-text\">fs.readFileSync()</code> it.\nWhen I’m working with test and ‘prod’ data, I’ll leave two filename declarations in and uncomment/comment one out for testing. The final dataset for day 3 is huge. My initial attempt went from 10s of minutes to a few seconds. The addition of the testfile was pretty necessary here, if just for a sanity check.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> filename <span class=\"token operator\">=</span> <span class=\"token string\">'./3/final'</span>\n<span class=\"token comment\">// const filename = './3/test-dataset-1'</span>\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>wire1<span class=\"token punctuation\">,</span> wire2<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> fs<span class=\"token punctuation\">.</span><span class=\"token function\">readFileSync</span><span class=\"token punctuation\">(</span>filename<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">split</span><span class=\"token punctuation\">(</span><span class=\"token string\">'\\n'</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h2>Parsing it</h2>\n<p>Here was my thought process: Create a 2D array, populate that matrix with dots and draw on the diagrams. Simple, right? This happens in <code class=\"language-text\">defineGrid()</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">let</span> xHeight <span class=\"token operator\">=</span> yHeight <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">getMax</span><span class=\"token punctuation\">(</span><span class=\"token operator\">...</span>sets<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">max</span><span class=\"token punctuation\">(</span>sets<span class=\"token punctuation\">.</span><span class=\"token function\">flat</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span>dir <span class=\"token operator\">=></span> dir<span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token regex\">/[a-z]/i</span><span class=\"token punctuation\">,</span> <span class=\"token string\">''</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span>num <span class=\"token operator\">=></span> <span class=\"token function\">parseInt</span><span class=\"token punctuation\">(</span>num<span class=\"token punctuation\">,</span> <span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">defineGrid</span><span class=\"token punctuation\">(</span>coords<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// sum up all left, right, up, down and find the max u/d and l/r</span>\n    <span class=\"token keyword\">const</span> up <span class=\"token operator\">=</span> coords<span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span>dir <span class=\"token operator\">=></span> dir<span class=\"token punctuation\">.</span><span class=\"token function\">indexOf</span><span class=\"token punctuation\">(</span><span class=\"token string\">'U'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">===</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">const</span> down <span class=\"token operator\">=</span> coords<span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span>dir <span class=\"token operator\">=></span> dir<span class=\"token punctuation\">.</span><span class=\"token function\">indexOf</span><span class=\"token punctuation\">(</span><span class=\"token string\">'D'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">===</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">const</span> left <span class=\"token operator\">=</span> coords<span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span>dir <span class=\"token operator\">=></span> dir<span class=\"token punctuation\">.</span><span class=\"token function\">indexOf</span><span class=\"token punctuation\">(</span><span class=\"token string\">'L'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">===</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">const</span> right <span class=\"token operator\">=</span> coords<span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span>dir <span class=\"token operator\">=></span> dir<span class=\"token punctuation\">.</span><span class=\"token function\">indexOf</span><span class=\"token punctuation\">(</span><span class=\"token string\">'R'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">===</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n\n\n    yHeight <span class=\"token operator\">=</span> <span class=\"token function\">getMax</span><span class=\"token punctuation\">(</span>up<span class=\"token punctuation\">,</span> down<span class=\"token punctuation\">)</span>\n    xHeight <span class=\"token operator\">=</span> <span class=\"token function\">getMax</span><span class=\"token punctuation\">(</span>left<span class=\"token punctuation\">,</span> right<span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">const</span> grid <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Array</span><span class=\"token punctuation\">(</span>yHeight<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> y <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> y <span class=\"token operator\">&lt;</span> yHeight <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span> y<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        grid<span class=\"token punctuation\">[</span>y<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Array</span><span class=\"token punctuation\">(</span>xHeight<span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> x <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> x <span class=\"token operator\">&lt;</span> xHeight <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span> x<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            grid<span class=\"token punctuation\">[</span>y<span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>x<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token string\">'.'</span>\n        <span class=\"token punctuation\">}</span>\n\t<span class=\"token punctuation\">}</span> \n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><code class=\"language-text\">defineGrid()</code> works in the following way:</p>\n<ol>\n<li>Split all directions in to their own array</li>\n<li>Find the largest number in on the x and y axis</li>\n<li>Populate a 2D array of dots (<code class=\"language-text\">.</code>) per the max x and y figures.</li>\n</ol>\n<p>The issue lies in 2). We could go up, left and up again. The sum of those ‘up’s could be more than the max x value! The program threw an error. A quick change of <code class=\"language-text\">getMax()</code> solves this: Sum up all of the figures in the array:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">getMax</span><span class=\"token punctuation\">(</span><span class=\"token operator\">...</span>sets<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> sets<span class=\"token punctuation\">.</span><span class=\"token function\">flat</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span>dir <span class=\"token operator\">=></span> dir<span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token regex\">/[a-z]/i</span><span class=\"token punctuation\">,</span> <span class=\"token string\">''</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">reduce</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>acc<span class=\"token punctuation\">,</span> cur<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> acc <span class=\"token operator\">+</span> cur<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><strong>Note:</strong> By setting the initial value of the accumulator (<code class=\"language-text\">acc</code>) in the reduce piece, all of our values for current (<code class=\"language-text\">cur</code>) are coerced to Numbers.</p>\n<h2>The Solution</h2>\n<p>The solution was likely how you’d think it. Display the wires like they are on the site and find the <code class=\"language-text\">X</code>s. To do this I loop through <code class=\"language-text\">[wire1, wire2]</code> and draw their diagrams. Earlier, I parsed a map for the diagram:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> x <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> x <span class=\"token operator\">&lt;</span> xHeight <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span> x<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\tgrid<span class=\"token punctuation\">[</span>y<span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>x<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token string\">'.'</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>So, I follow the ‘instructions’ for each wire diagram, replacing a <code class=\"language-text\">.</code> with a <code class=\"language-text\">|</code> or <code class=\"language-text\">-</code> dependent on where we’re moving. Again, if grid[x][y] isn’t a <code class=\"language-text\">.</code>, draw an <code class=\"language-text\">X</code>. The lines are there to help with a visualiser, which I’ve yet to implement. </p>\n<p>Let’s look at how I draw the wire diagram. It’s split in to four phases; let’s decompose it:</p>\n<h3>1. Define a Cursor</h3>\n<p>This is pretty straightforward:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> cursor <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>x<span class=\"token punctuation\">:</span> xHeight<span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">}</span></code></pre></div>\n<h3>2 .Split and Iterate</h3>\n<p>Again, straightforward:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> coord <span class=\"token keyword\">of</span> wire<span class=\"token punctuation\">.</span><span class=\"token function\">split</span><span class=\"token punctuation\">(</span><span class=\"token string\">','</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token comment\">// left as an exercise to the reader :^)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3>3. Decompose the Instruction</h3>\n<p>A little less straightforward…</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>dir<span class=\"token punctuation\">,</span> <span class=\"token operator\">...</span>nums<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> coord<span class=\"token punctuation\">.</span><span class=\"token function\">split</span><span class=\"token punctuation\">(</span><span class=\"token string\">''</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">const</span> paces <span class=\"token operator\">=</span> <span class=\"token function\">parseInt</span><span class=\"token punctuation\">(</span>nums<span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span><span class=\"token string\">''</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">10</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h3>4. Move and draw!</h3>\n<p>Somewhat straightforward, but a mess.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">moveAndDraw</span><span class=\"token punctuation\">(</span>cursor<span class=\"token punctuation\">,</span> dir<span class=\"token punctuation\">,</span> symbol<span class=\"token punctuation\">,</span> amt<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\tcursor<span class=\"token punctuation\">[</span>dir<span class=\"token punctuation\">]</span> <span class=\"token operator\">+=</span> amt\n\tgrid<span class=\"token punctuation\">[</span>cursor<span class=\"token punctuation\">.</span>y<span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>cursor<span class=\"token punctuation\">.</span>x<span class=\"token punctuation\">]</span> <span class=\"token operator\">===</span> <span class=\"token string\">'.'</span> <span class=\"token operator\">?</span> symbol <span class=\"token punctuation\">:</span> <span class=\"token string\">'X'</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">switch</span> <span class=\"token punctuation\">(</span>dir<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">case</span> <span class=\"token string\">'U'</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> y <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span> y <span class=\"token operator\">&lt;</span> num<span class=\"token punctuation\">;</span> y<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span>\n\t\t\t<span class=\"token function\">moveAndDraw</span><span class=\"token punctuation\">(</span>cursor<span class=\"token punctuation\">,</span> <span class=\"token string\">'y'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'|'</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\t\n\t\t<span class=\"token function\">moveAndDraw</span><span class=\"token punctuation\">(</span>cursor<span class=\"token punctuation\">,</span> <span class=\"token string\">'y'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'+'</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token keyword\">case</span> <span class=\"token string\">'D'</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> y <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span> y <span class=\"token operator\">&lt;</span> num<span class=\"token punctuation\">;</span> y<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span>\n\t\t\t<span class=\"token function\">moveAndDraw</span><span class=\"token punctuation\">(</span>cursor<span class=\"token punctuation\">,</span> <span class=\"token string\">'y'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'|'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\t\n\t\t<span class=\"token function\">moveAndDraw</span><span class=\"token punctuation\">(</span>cursor<span class=\"token punctuation\">,</span> <span class=\"token string\">'y'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'+'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token keyword\">case</span> <span class=\"token string\">'L'</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> y <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span> y <span class=\"token operator\">&lt;</span> num<span class=\"token punctuation\">;</span> y<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span>\n\t\t\t<span class=\"token function\">moveAndDraw</span><span class=\"token punctuation\">(</span>cursor<span class=\"token punctuation\">,</span> <span class=\"token string\">'x'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'-'</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\t\n\t\t<span class=\"token function\">moveAndDraw</span><span class=\"token punctuation\">(</span>cursor<span class=\"token punctuation\">,</span> <span class=\"token string\">'x'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'+'</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token keyword\">case</span> <span class=\"token string\">'R'</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> y <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span> y <span class=\"token operator\">&lt;</span> num<span class=\"token punctuation\">;</span> y<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span>\n\t\t\t<span class=\"token function\">moveAndDraw</span><span class=\"token punctuation\">(</span>cursor<span class=\"token punctuation\">,</span> <span class=\"token string\">'x'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'-'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\t\n\t\t<span class=\"token function\">moveAndDraw</span><span class=\"token punctuation\">(</span>cursor<span class=\"token punctuation\">,</span> <span class=\"token string\">'x'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'+'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><code class=\"language-text\">moveAndDraw()</code> Does what it says on the tin. Move a <code class=\"language-text\">cursor</code> in a <code class=\"language-text\">direction</code> and draw a <code class=\"language-text\">symbol</code>. Move this cursor by a given <code class=\"language-text\">amount</code>. Any input on the <code class=\"language-text\">case</code> would be appreciated - it’s a mess!</p>\n<h2>Memory Issues</h2>\n<p>Before we discuss calculating the Manhattan Distance, I’ve to to chat about some memory issues. As it turns out, this way <em>works</em>, but it’s pretty lazy when it comes to memory. Let’s go back to grid creation…</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> y <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> y <span class=\"token operator\">&lt;</span> yHeight <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span> y<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        grid<span class=\"token punctuation\">[</span>y<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Array</span><span class=\"token punctuation\">(</span>xHeight<span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> x <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> x <span class=\"token operator\">&lt;</span> xHeight <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span> x<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            grid<span class=\"token punctuation\">[</span>y<span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>x<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token string\">'.'</span>\n        <span class=\"token punctuation\">}</span>\n\t<span class=\"token punctuation\">}</span> </code></pre></div>\n<p>This doesn’t look so bad. Initialise a 2D array of dots. Let’s look at the final values for <code class=\"language-text\">xHeight</code> and <code class=\"language-text\">yHeight</code>…</p>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/large-grid-56d4894e1afd45613d9f1ff0fe7719e0-acba2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 439px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 11.389521640091118%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAAAsSAAALEgHS3X78AAAAfklEQVQI1z3MOxaDIAAAQU8CREUBRfxijPKSKo33P8+GKsU0W2wR7y/m3GmWkSort4UyLvTrxO6eJHNlCWs897vjcJpD12whMG0jfawIZ4OPGvUQFOcn8boScY/UTc28elzXYqxlGAZsYwneMc89rS5RUqBEJmUeKKQSfyL3H4koPKG4PPKiAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"One huge grid\"\n        title=\"\"\n        src=\"/static/large-grid-56d4894e1afd45613d9f1ff0fe7719e0-acba2.png\"\n        srcset=\"/static/large-grid-56d4894e1afd45613d9f1ff0fe7719e0-3af6d.png 240w,\n/static/large-grid-56d4894e1afd45613d9f1ff0fe7719e0-acba2.png 439w\"\n        sizes=\"(max-width: 439px) 100vw, 439px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>That’s 23,633,280,652 elements in the array. We can get the size of a <code class=\"language-text\">.</code> in node using <code class=\"language-text\">Buffer</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">Buffer<span class=\"token punctuation\">.</span><span class=\"token keyword\">from</span><span class=\"token punctuation\">(</span><span class=\"token string\">'.'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>length\n<span class=\"token comment\">// 1</span></code></pre></div>\n<p>Already we can see that this is at least going to be 23GB, not to mention when we start working on that array…</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">FATAL ERROR: Ineffective mark-compacts near heap limit Allocation failed - JavaScript heap out of memory</code></pre></div>\n<h3>Memory Improvement</h3>\n<p>The point of the array of dots was to implement a visualiser. If we did away with that, we’d save significantly on memory. Easily, we can just spin up our original Y array, and populate the X columns when necessary.</p>\n<p>The program should start using only 150,000 spaces in the array, or 150KB! Obviously, this comes with issues. More validation when checking… Does <code class=\"language-text\">grid[y][x]</code> actually exist before we compare? But we can code for that.</p>\n<p>We can also use the <a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/delete\"><code class=\"language-text\">delete</code> keyword</a> in JavaScript - remove a variable. According to MDN:</p>\n<blockquote>\n<p>The JavaScript delete operator removes a property from an object; if no more references to the same property are held, it is eventually released automatically</p>\n</blockquote>\n<p>Because top-level variables belong to <code class=\"language-text\">global</code> (node) or <code class=\"language-text\">window</code> (browser), they can be deleted too!</p>\n<p>We can bin off a few things here. Let’s delete the original wires, because they’re not used anymore. Let’s also delete the grid once we’ve added stuff to it and found our intersections.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">delete</span> wire1\n<span class=\"token keyword\">delete</span> wire2\n\n<span class=\"token comment\">// working code goes here</span>\n\n<span class=\"token keyword\">delete</span> grid\n\n<span class=\"token comment\">// figure out the manhattan distance</span></code></pre></div>\n<p>Of course, we can remove other stuff - but I won’t bore you with it all.</p>\n<p>Another thing we could look at is dynamically extending the array when necessary. When we traverse, we could add a check for the new location and if the array isn’t long enough, extend it. I never actually implemented this, but we can look at it might work. If we take <code class=\"language-text\">modeAndDraw()</code> for example:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">moveAndDraw</span><span class=\"token punctuation\">(</span>cursor<span class=\"token punctuation\">,</span> dir<span class=\"token punctuation\">,</span> symbol<span class=\"token punctuation\">,</span> amt<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\tcursor<span class=\"token punctuation\">[</span>dir<span class=\"token punctuation\">]</span> <span class=\"token operator\">+=</span> amt\n\tgrid<span class=\"token punctuation\">[</span>cursor<span class=\"token punctuation\">.</span>y<span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>cursor<span class=\"token punctuation\">.</span>x<span class=\"token punctuation\">]</span> <span class=\"token operator\">===</span> <span class=\"token string\">'.'</span> <span class=\"token operator\">?</span> symbol <span class=\"token punctuation\">:</span> <span class=\"token string\">'X'</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>The program just adds the symbol because we’re confident that the array is that long. By dynamically allocating the array, we could do something like:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">moveAndDraw</span><span class=\"token punctuation\">(</span>cursor<span class=\"token punctuation\">,</span> dir<span class=\"token punctuation\">,</span> symbol<span class=\"token punctuation\">,</span> amt<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\tcursor<span class=\"token punctuation\">[</span>dir<span class=\"token punctuation\">]</span> <span class=\"token operator\">+=</span> amt\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>grid<span class=\"token punctuation\">[</span>cursor<span class=\"token punctuation\">.</span>y<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> grid<span class=\"token punctuation\">[</span>cursor<span class=\"token punctuation\">.</span>y<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Array</span><span class=\"token punctuation\">(</span>cursor<span class=\"token punctuation\">.</span>x<span class=\"token punctuation\">)</span>\n\tgrid<span class=\"token punctuation\">[</span>cursor<span class=\"token punctuation\">.</span>y<span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>cursor<span class=\"token punctuation\">.</span>x<span class=\"token punctuation\">]</span> <span class=\"token operator\">===</span> <span class=\"token string\">'.'</span> <span class=\"token operator\">?</span> symbol <span class=\"token punctuation\">:</span> <span class=\"token string\">'X'</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>This is a little off-the-top-of-my-head, but it <em>should</em> work…</p>\n<p>I know this was a little over-hyped on the memory management side of things, but it’s a nice reminder that the computers we have still have limiatations - as well as the engineers behind them!</p>\n<h2>The Manhattan Distance</h2>\n<p>A quick primer on the manhattan distance before I explain how I worked this out. A quick tl;dr is:</p>\n<blockquote>\n<p>The sum of all vertical and horizontal movement from Point A to Point B</p>\n</blockquote>\n<p>For example, the manhattan distance below is 7. We move up 4 and across 3:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">......\n.+--B.\n.|....\n.|....\n.|....\n.A....\n......</code></pre></div>\n<h3>My Solution</h3>\n<p>Again, this is a simple one - but likely doesn’t scale well. All we need to do is find where each intersection is and calculate the relevant manhattan distance. From that, pull out the smallest distance!</p>\n<h4>Find Every Intersection</h4>\n<p>Just loop <code class=\"language-text\">x/y</code> through the grid and save that to a results list.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> results <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    o<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    x<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span>\n\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"> Beginning traverse\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> y <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> y <span class=\"token operator\">&lt;</span> grid<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span> y<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>grid<span class=\"token punctuation\">[</span>y<span class=\"token punctuation\">]</span> <span class=\"token operator\">!==</span> undefined<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> x <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> x <span class=\"token operator\">&lt;</span> grid<span class=\"token punctuation\">[</span>y<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span> x<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>grid<span class=\"token punctuation\">[</span>y<span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>x<span class=\"token punctuation\">]</span> <span class=\"token operator\">===</span> <span class=\"token string\">'X'</span><span class=\"token punctuation\">)</span> results<span class=\"token punctuation\">.</span>x<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>y<span class=\"token punctuation\">,</span> x<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>grid<span class=\"token punctuation\">[</span>y<span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>x<span class=\"token punctuation\">]</span> <span class=\"token operator\">===</span> <span class=\"token string\">'o'</span><span class=\"token punctuation\">)</span> results<span class=\"token punctuation\">.</span>o <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>y<span class=\"token punctuation\">,</span>x<span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h4>Calculate the Manhattan Distance</h4>\n<p>Here, I mix some funtional programming with procedural stuff. Purists hate me.</p>\n<p>The program maps over <code class=\"language-text\">results.x</code> (poor naming, I know) and finds the distance - <code class=\"language-text\">dy/dx</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> distances <span class=\"token operator\">=</span> results<span class=\"token punctuation\">.</span>x<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span>crd <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span>results<span class=\"token punctuation\">.</span>o<span class=\"token punctuation\">.</span>x <span class=\"token operator\">-</span> crd<span class=\"token punctuation\">.</span>x<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span>results<span class=\"token punctuation\">.</span>o<span class=\"token punctuation\">.</span>y <span class=\"token operator\">-</span> crd<span class=\"token punctuation\">.</span>y<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h4>Find The Smallest Distance</h4>\n<p>We could abuse JavaScript and do this in a few ways. I used <code class=\"language-text\">Math.min()</code>. I’ll put a few below</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> min <span class=\"token operator\">=</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">min</span><span class=\"token punctuation\">(</span><span class=\"token operator\">...</span>distances<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>smallest<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> distances<span class=\"token punctuation\">.</span><span class=\"token function\">sort</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">const</span> minimal <span class=\"token operator\">=</span> distances<span class=\"token punctuation\">.</span><span class=\"token function\">sort</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">shift</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h1>Wrap-Up</h1>\n<p>To conclude, this was a pretty fun project. It reminded me that memory was something to consider even if I don’t use a language that gives me direct access to it.</p>\n<p>I’ve put the <a href=\"https://github.com/hjfitz/advent-of-code-2019/tree/master/3\">code on GitHub</a> for your browsing pleasure. Note that I’ve taken this post as an opportunity to refactor it. It’s still a mess on GitHub.</p>","fields":{"tagSlugs":["/tags/code/"],"slug":"/posts/advent-of-code-day-3/"},"frontmatter":{"title":"Basic Memory Management in Node: Advent of Code Day 3","tags":["Code"],"date":"2019-12-23T21:31:00.000Z","description":"I wrote a node program that took >100GB of memory. It didn't even use Electron."}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/posts/advent-of-code-day-3/"}}}