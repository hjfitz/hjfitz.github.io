{"componentChunkName":"component---src-templates-post-template-jsx","path":"/posts/listen-to-page-renders/","webpackCompilationHash":"258b8e959ddcc7e281d1","result":{"data":{"site":{"siteMetadata":{"title":"Harry's Tech Blog","subtitle":"Personal development. Tech. Bugs.","copyright":"(copyleft) no rights reserved.","author":{"name":"Harry Fitzgerald"},"url":"https://www.hjf.io"}},"markdownRemark":{"id":"42b15ce3-bf7b-58b3-a547-f5a4b3419716","html":"<p>I saw an awesome <a href=\"https://gist.github.com/tomhicks/6cb5e827723c4eaef638bf9f7686d2d8\">Gist</a> called <code class=\"language-text\">plink-plonk.js</code> the other day. It shows you how you can, for single page apps, listen to how a page changes and re-renders.</p>\n<p>The code’s pretty simple too:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> audioCtx <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token punctuation\">(</span>window<span class=\"token punctuation\">.</span>AudioContext <span class=\"token operator\">||</span> window<span class=\"token punctuation\">.</span>webkitAudioContext<span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">const</span> observer <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">MutationObserver</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span>mutationsList<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> oscillator <span class=\"token operator\">=</span> audioCtx<span class=\"token punctuation\">.</span><span class=\"token function\">createOscillator</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n  oscillator<span class=\"token punctuation\">.</span><span class=\"token function\">connect</span><span class=\"token punctuation\">(</span>audioCtx<span class=\"token punctuation\">.</span>destination<span class=\"token punctuation\">)</span>\n  oscillator<span class=\"token punctuation\">.</span>type <span class=\"token operator\">=</span> <span class=\"token string\">\"sine\"</span>\n  oscillator<span class=\"token punctuation\">.</span>frequency<span class=\"token punctuation\">.</span><span class=\"token function\">setValueAtTime</span><span class=\"token punctuation\">(</span>\n    Math<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>mutationsList<span class=\"token punctuation\">.</span>length <span class=\"token operator\">+</span> <span class=\"token number\">5</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token number\">880</span><span class=\"token punctuation\">,</span>\n    audioCtx<span class=\"token punctuation\">.</span>currentTime<span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">)</span>\n\n  oscillator<span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  oscillator<span class=\"token punctuation\">.</span><span class=\"token function\">stop</span><span class=\"token punctuation\">(</span>audioCtx<span class=\"token punctuation\">.</span>currentTime <span class=\"token operator\">+</span> <span class=\"token number\">0.01</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\nobserver<span class=\"token punctuation\">.</span><span class=\"token function\">observe</span><span class=\"token punctuation\">(</span>document<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n  attributes<span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n  childList<span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n  subtree<span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n  characterData<span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> </code></pre></div>\n<p>Create an audio context and observer, and observe the document. For each change, oscillate.</p>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/owl-47080c0c86f75bb46ff24b8b6708c56c-4e7e8.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 530px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 85.47169811320755%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAIAAABSJhvpAAAACXBIWXMAAAsSAAALEgHS3X78AAACFElEQVQ4y51TyY7iQAzN//MBHIEDB0BCwFxAgISEEAcObBKLGHYlLAkhoVIhqZCkX5eBaUZzGqtlql1+fq9sR4nj+HK5mKYJf9b16/VqGIbneYhHURSGIbymaY/HA5EgCChCpiBkWZbDGP5s23YcB14IgTgAyEChQqGwWq2Ox2O/36eKVEKR9UQQPC6W7bheIBmiCC6+S9vv99lsNp/Pp1KpwWBARZ9gmRYblm1zjhAeQAopCX48Htfr9Uwmk0gkRqPRJ1iyaLqhXy1fiK2qctelB8N83/8lrVwup9PpYrGIZyNOL1IoD0jdtCzm7FUNv4TEFWOs3W7vdrvFYlEqlZLJ5HK5pM49wZ4IHNleqIHn7p1xTso559PpFK3abrez2SyXyzWbzQ+wLwLL+c6OXmqZ4xDz7XYD5++XNRoNvP8DDJB5Y88+E6F7D0kF5+v1WlVVjPpwOKBhk8nkPUWF5IHcZpzY4O++H0YhNsd1XQgGJ8C6rs/n87/fTIbme0K43h2aaUjgxFa0Wi3gv/fvfN5sNlhBIoB/g6NXiZAuKAOysa0YNaZVq9XQreFwCCGoBQLlnffT04GWgfa32+12Op1er4czWggtWOE/sv9ptMm0qtVqtVKp/OSQo/J9fA+4dqVhMcCJlrCXYWDQD7X4PPAvzkh+gnGHMaAfujQMBuVwjd04nU6I4ABPXy7NDIePbv+HfQFxirz9v9MgbQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"Daw the rest of the fucking owl...\"\n        title=\"\"\n        src=\"/static/owl-47080c0c86f75bb46ff24b8b6708c56c-4e7e8.png\"\n        srcset=\"/static/owl-47080c0c86f75bb46ff24b8b6708c56c-2fecf.png 240w,\n/static/owl-47080c0c86f75bb46ff24b8b6708c56c-cb8e2.png 480w,\n/static/owl-47080c0c86f75bb46ff24b8b6708c56c-4e7e8.png 530w\"\n        sizes=\"(max-width: 530px) 100vw, 530px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    \nI thought that this is pretty interesting, but all around useless outside of your own site. If you want to listen to other sites, you need them to implement this.</p>\n<p>It got me thinking, how do we execute our own JavaScript on other websites? Web Extensions.</p>\n<h1>Web Extensions API</h1>\n<p>The <a href=\"https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions\">Web Extensions API</a> allows us to write custom JavaScript to run on any site, to enhance the experience.</p>\n<p>Now that this is a standard API for browsers, it’s easy enough to write a basic extension. Let’s start with folder structure:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">- dist/\n  - manifest.json\n  - extension.js</code></pre></div>\n<ul>\n<li>\n<p><strong>dist:</strong> Where our final extension lies</p>\n<ul>\n<li><strong>manifest.json:</strong> Metadata about our web extension</li>\n<li><strong>extension.js:</strong> The core code for our extension. If we wanted, we could split this out in to different files in a <code class=\"language-text\">src/</code> directory and use webpack to bundle it. I’ve done this <a href=\"https://github.com/hjfitz/WEBRES-1\">here</a></li>\n<li>As an aside, this is a pretty cool extension</li>\n</ul>\n</li>\n</ul>\n<h2>Extension Manifest</h2>\n<p>Let’s talk about the <a href=\"https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json\">manifest</a>. This defines how our application works.</p>\n<p>For our purposes, we just want to inject the aforementioned <code class=\"language-text\">plink-plonk.js</code> to any page. Let’s look at our manifest.json:</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n\t<span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Listen to Browser Renders\"</span><span class=\"token punctuation\">,</span>\n\t<span class=\"token property\">\"version\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"1.0\"</span><span class=\"token punctuation\">,</span>\n\t<span class=\"token property\">\"description\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Listen to a SPA render\"</span><span class=\"token punctuation\">,</span>\n\t<span class=\"token property\">\"permissions\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"activeTab\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n\t<span class=\"token property\">\"content_scripts\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n\t\t<span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token property\">\"matches\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"&lt;all_urls>\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token property\">\"run_at\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"document_end\"</span><span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token property\">\"js\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"ext.js\"</span><span class=\"token punctuation\">]</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n\t<span class=\"token property\">\"manifest_version\"</span><span class=\"token operator\">:</span> <span class=\"token number\">2</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>There’s a lot of stuff here that speaks for itself. We’re interested in demistifying <code class=\"language-text\">permissions</code>, <code class=\"language-text\">content_scripts</code> and <code class=\"language-text\">manifest_version</code>.</p>\n<ul>\n<li>\n<p><strong>permissions:</strong> Which <a href=\"https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/permissions\">permissions</a> does the extension want to ask for. Here, we just want to use the active tab. You can ask for a lot more too. There are some interesting permissions, so check these over when you install a new extension… A few of note are:</p>\n<ul>\n<li>downloads</li>\n<li>browsingData</li>\n<li>topSites</li>\n<li>cookies</li>\n</ul>\n</li>\n<li>\n<p><strong>content_scripts:</strong> These are scripts that run on the <code class=\"language-text\">matches</code> key.</p>\n<ul>\n<li><strong>matches:</strong> Which URL to run on. We want all, so <code class=\"language-text\">&lt;all_urls&gt;</code> hits this.</li>\n<li><strong>run_at:</strong> When to run the script. I’ve gone for <code class=\"language-text\">document_end</code>. This is the same as wrapping your code in <code class=\"language-text\">$(document).ready()</code> or just firing it when <code class=\"language-text\">DOMContentLoaded</code> is fired.</li>\n<li><strong>js:</strong> Which JavaScript file to execute.</li>\n</ul>\n</li>\n<li><strong>manifest_version:</strong> The version of the Web Extension manifest to follow. Not sure why we don’t us the standard <code class=\"language-text\">$schema</code> key here.</li>\n</ul>\n<h1>The Code</h1>\n<p>Honestly, there’s not a lot to say here. I just took <code class=\"language-text\">plink-plonk.js</code> and shoved it in to <code class=\"language-text\">ext.js</code> that I refer to in the manifest file.</p>\n<h1>Loading the Extension</h1>\n<p>To install this manually, go to extensions and you should get the option to load it.</p>\n<p>In Chrome: Make sure developer mode is on; hit <code class=\"language-text\">load unpacked extension</code> at the top left, navigate to the folder that your extension sits in and load it.</p>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/chrome-load-61621aa8f03813b8ff9ee3d7360c7c48-41e23.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 572px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 61.01398601398601%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsSAAALEgHS3X78AAAB7ElEQVQoz4VSTW/TQBD1TyHqFSEuKeUHABLKoQdu0MKhcKYHflklDigcqgqJO5d+0DROm8RNYq8dx+v99GPGriNKJTLS07zdnXk7szvB7tYPfHh6if0nZ+TPsff4HG86p5vx6Ay9Th+vO0fobX1dI3jf/YnPL0IcvrrEl94VDl8OcLB9gY/PLvBppwFz3mvXzA+6v/Gue4y329+wt/Od0Mf+8z6CcDBGLiqMhxo3A43bGwNVOsSRRXRtMB0ZiIWFpj0+m00Mcd9AooZqUQDBZDJGVQGr3KBYWRKzqOCglK3X9Z628BXx3EIWzB3leIp7iOBqOILznpI0tDG1L5WGtRbOWRhrYJ0j7+ApznlHZ45iqWrN8Q2Yc14QhteU4CHLRojBwlIapFSd8xXm8zkWixjTaVTzKLpFUcj6AraKWyQzVEQwHDaCLKTubjFUZa6B6OQYdjaBWOZI0xRJIhDHMQopa5FWaKOgIrD5dAFfStxl3Uv+2zYLkl/fzsLUWouKvXP39+pqSdD8R7A1R8l5vqSWEwghkKQZEpES5ydIqBu1jrWOBcOHgvwppfRYiuZ2uSKeuvqDXFHA0pu2jbOolIrmk+LkPxU2aEYnzzTiGX0QiWdCI5nreh5VlqGMk/UYheGIRJc4/VUiyxT+AEdiaDEUGQeWAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"Load the extension in Chrome\"\n        title=\"\"\n        src=\"/static/chrome-load-61621aa8f03813b8ff9ee3d7360c7c48-41e23.png\"\n        srcset=\"/static/chrome-load-61621aa8f03813b8ff9ee3d7360c7c48-c2b80.png 240w,\n/static/chrome-load-61621aa8f03813b8ff9ee3d7360c7c48-bf6fa.png 480w,\n/static/chrome-load-61621aa8f03813b8ff9ee3d7360c7c48-41e23.png 572w\"\n        sizes=\"(max-width: 572px) 100vw, 572px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>In Firefox: Go to <code class=\"language-text\">about:debugging</code> and hit <code class=\"language-text\">Load temporary extension</code>. Navigate to your manifest file and load that.</p>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/firefox-load-5edd2a9e1b3d2ce1e04b8d72440e2ad7-6fa01.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 960px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 42.46987951807229%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsSAAALEgHS3X78AAABZUlEQVQoz5WRzU7CQBSF+y6AiibgRhf+s/AN3fse+IORBUiJJq5sYpOiKQozhem0nba09Dgz2ASjGyf5cubOvXPvmdY4a53j+KSFw6NT7O0fYKu+g3p9G83mrqbRKLWJWm0TlUrtm+qarqhWN2C021fodrvodO5wc3Ortd9/gDl8wvDxGaY51AwGpj4v6fVW/Dzrw+A8RFEU+LUyAaQT/HcZI+cNL5YNyiKEUQwRCiQyMb++x+flBXgcwqMzzOcMnjcDlXvGfAgR/4kxdj9APQ4mckQiRZKkSBcZ5pMZJvZY5jwQQjVRJJCmi1WNVMVC1irK2JhOCTj3wX0fcZzoYgWTMeNcN6LU0ygHZUOFqnddF6PRu9SxfoFsSHXS9wMJRxhGyLJcDuGwX23pKtJ79UzlcLkskOe5ZKk1SRIEQQDLsqDMGYR42rK6oFhv6DiOjEM9iDEmHcX6w6ufWKKWGkII0cO/ADPRLxbFqRE9AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"Load the extension in Firefox\"\n        title=\"\"\n        src=\"/static/firefox-load-5edd2a9e1b3d2ce1e04b8d72440e2ad7-c83f1.png\"\n        srcset=\"/static/firefox-load-5edd2a9e1b3d2ce1e04b8d72440e2ad7-569e3.png 240w,\n/static/firefox-load-5edd2a9e1b3d2ce1e04b8d72440e2ad7-93400.png 480w,\n/static/firefox-load-5edd2a9e1b3d2ce1e04b8d72440e2ad7-c83f1.png 960w,\n/static/firefox-load-5edd2a9e1b3d2ce1e04b8d72440e2ad7-6fa01.png 996w\"\n        sizes=\"(max-width: 960px) 100vw, 960px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<h1>Remarks</h1>\n<p>This is a pretty cool thing to listen to how a page changes. The more noise really does equate to how noisy your page is on load. The less noise might mean a better user experience (on load) as there’s less jumping about.</p>\n<p>The Observer API doesn’t seem to work too well on Firefox though, there’s less audio generated.</p>","fields":{"tagSlugs":["/tags/code/","/tags/web-extension/","/tags/web-ap-is/"],"slug":"/posts/listen-to-page-renders/"},"frontmatter":{"title":"Ever *heard* How a Webpage Renders?","tags":["Code","Web Extension","Web APIs"],"date":"2020-02-16T15:43:00.000Z","description":"Let's make noises when webpages render nodes through JavaScript, and learn how to stuff that in to an extension to hear how other pages render"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/posts/listen-to-page-renders/"}}}